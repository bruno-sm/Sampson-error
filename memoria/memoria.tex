\input{./preambulo.tex}

\title{	
\normalfont \normalsize 
\textsc{\textbf{Visión por computador (2018-2019)} \\ Doble Grado en Informática y Matemáticas \\ Universidad de Granada} \\ [25pt]
\horrule{0.5pt} \\[0.4cm]
\huge Estimación de homografías usando el error de Sampson \\
\horrule{1pt} \\[0.5cm]
}
\author{Iñaki Madinabeitia Cabrera\\
Bruno Santidrián Manzanedo}
\date{\normalsize\today}



\begin{document}
\maketitle
\newpage
\tableofcontents
\newpage

\section{Intoducción}
Este trabajo consiste en implementar un algoritmo de estimación de homografías que utilice el error de Samson, tal como se describe en \cite{mvg}, como medida de su bondad. Esto es que, dados dos conjuntos de puntos, el algoritmo debe aproximar una homografía que lleve un conjunto en el otro cuyo error de Sampson sea razonablemente bajo.\\

Para el proceso de aproximación de la homografía \cite{mvg} recomienda el uso de algoritmos iterativos, los cuales, a grandes rasgos, se componen de los siguientes elementos:\\

\begin{itemize}
  \item \textbf{Función de coste:} En nuestro caso será el error de Sampson.\\
  
  \item \textbf{Parametrización:} Dado que el objeto a minimizar es una homografía los parámetros serán simplemente los elementos que conforman la matriz.\\
  
  \item \textbf{Especificación de la función:} Se debe especificar una función que exprese el coste en términos de un conjunto de parámetros. En nuestro caso calculará el error de Sampson a partir de una homografía y dos conjuntos de puntos; la implementación de esta función se puede encontrar en \textit{src/sampson.py}.\\
  
  \item \textbf{Inicialización:} Se calcula una homografía inicial. Para ello nosotros hemos decidido utilizar RANSAC, ya que aunque es más costoso que DLT, tener una solución inicial menos afectada por los outliers mejora el resultado final. La implementación de RANSAC se puede encontrar en \textit{src/ransac.py}.\\
  
  \item \textbf{Iteración:} IÑAKI.\\
\end{itemize}

Podemos, por tanto, distinguir tres elementos importantes: El error de Sampson, \mbox{RANSAC} y el algoritmo iterativo. Pasemos a hablar de cada uno de forma más detallada.


\section{Detalles y decisiones de implementación}

\subsection{Error de Sampson}
Para el cálculo del error de sampson hemos usado la fórmula (4.13) descrita en la página 100 de \cite{mvg}, es decir
$$D_{\bot} = \sum_i{\epsilon_i^T (J_i J_i^T)^{-1} \epsilon_i}$$

Donde si $H$ es la matriz de la homografía, $h$ son los elementos de esta en forma de columna, $A_i$ es la matriz construida en DLT y $x_i = (x_i, y_i, 1)^T$ y $x_i' = (x_i', y_i', 1)^T$ son dos puntos en correspondencia, entonces:

$$\epsilon_i = A_ih$$

$$J_i = \frac{\partial A_ih}{\partial (x_i, y_i, x_i', y_i')}$$

Tras efectuar los cálculos tenemos:

$$J_i =
  \begin{bmatrix}
    h_7 y_i' - h_4 & h_8 y_i' - h_5 & 0 &  h_7 x_i + h_8 y_i + h_9\\
    h_1 - h_7 x_i' & h_2 - h_8 x_i' & -h_7 x_i - h_8 y_i - h_9 & 0\\
  \end{bmatrix}
$$

Donde $h_1,...,h_9$ son los elementos de $h$.\\

Esta fórmula se implementa en la función \textit{sampson\_error(pts1, pts2, H)} del archivo \textit{src/sampson.py}.


\subsection{RANSAC}

Para la implementación de RANSAC nos hemos basado en el apartado 4.7.1 de \cite{mvg}. Le damos los siguientes valores a los parámetros:

\begin{itemize}
  \item \textbf{Probabilidad inicial de que un punto sea un outlier (v):}
  Para estimar la probabilidad de que un punto sea un outlier usamos la aproximación adaptativa que se describe en la página 120, esto nos permite aproximarnos a la proporción real sin tener que analizar experimentalmente cada conjunto de correspondencias. Inicialmente se le otroga un valor de $0.6$.\\
  
  \item \textbf{Número de iteraciones (N):}
  Se calcula dinámicamente a medida que se acualiza $v$, para ello se utliliza la fórmula (4.18):
  $N = \frac{log(1-p)}{log(1-(1-v)^4)}$ donde $p=0.99$ es la proporción de inliers que esperamos obtener.\\
  
  \item \textbf{Tolerancia:}
  Consideramos que un punto es un outlier si presenta un error de más de 3 píxeles.\\
  
  \item \textbf{Tamaño aceptable del conjunto de inliers (T):}
  También se calcula dinámicamente a medida que se acualiza $v$, para ello se utliliza la fórmula presentada en la página 120: $T = (1-v)n$ donde $n$ es el número de correspondencias.\\
\end{itemize}

RANSAC utiliza DLT para calcular las homografías, este está implementado tal y como se indica en los apartados 4.1 y 4.1.1, usando la ecuación simplificada (4.3) y permitiendo soluciones sobre-determinadas. De esta forma RANSAC puede calcular la homografía final usando todos los inliers que ha detectado, lo que le dota de una robustez extra.\\

Tanto RANSAC como DLT están implementados en el archivo \textit{src/ransac.py}.

\subsection{Algoritmo iterativo}
IÑAKI

\section{Resultados y valoraciones}

\section{Posibles mejoras}

\newpage
\nocite{*}
\bibliographystyle{plain}
\bibliography{citas}
\end{document}
